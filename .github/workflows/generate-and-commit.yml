name: Generate and Commit Danmatsu + Summaries

on:
  schedule:
    - cron: '0 6,10,14,18,22 * * *'  # æ¯æ—¥5å›ï¼šæ–­æœ«é­”
    - cron: '0 23 * * 0'             # æ¯é€±æ—¥æ›œ23æ™‚ï¼šnoteç”¨ã¾ã¨ã‚
    - cron: '0 1 1 * *'              # æ¯æœˆ1æ—¥1æ™‚ï¼šzineç”¨ã¾ã¨ã‚
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install OpenAI SDK
        run: pip install openai==0.28

      - name: Run Danmatsu Generator (5å›/æ—¥)
        if: github.event.schedule == '0 6,10,14,18,22 * * *' || github.event_name == 'workflow_dispatch'
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: python generate_danmatsu.py

      - name: Generate Weekly note/ Summary (æ—¥æ›œå¤œ)
        if: github.event.schedule == '0 23 * * 0'
        run: python generate_note_summary.py

      - name: Generate Monthly zine/ Summary (1æ—¥æœ)
        if: github.event.schedule == '0 1 1 * *'
        run: python generate_zine_summary.py

      - name: Commit and Push Changes
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.name "syntax-death"
          git config --global user.email "no-reply@syntax.death"
          git remote set-url origin https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}
          git add .
          if git diff --cached --quiet; then
            echo "No changes to commit."
          else
            git commit -m "ğŸ¤– Auto-update: danmatsu + note/zine summary"
            git push origin HEAD:main
